<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrenaX API Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-text {
            background: linear-gradient(to right, #60A5FA, #A78BFA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        pre { margin: 0; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen">

    <!-- Navbar -->
    <nav class="border-b border-slate-800 bg-slate-900/80 backdrop-blur fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center font-bold text-white">O</div>
                    <span class="font-bold text-xl tracking-tight">OrenaX <span class="text-slate-500 font-normal">API</span></span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 border border-slate-700 text-xs">
                        <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                        <span id="server-status">Checking...</span>
                    </div>
                    <a href="/docs/gemini-api-v2/API-REFERENCE.md" target="_blank" class="text-sm text-slate-400 hover:text-white transition-colors">Full Docs</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        
        <!-- Hero -->
        <div class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold mb-4">
                The Next Gen <span class="gradient-text">AI Backend</span>
            </h1>
            <p class="text-slate-400 max-w-2xl mx-auto text-lg">
                Powered by Google Gemini 2.5, Vertex AI, and Supabase. 
                Test endpoints directly from this dashboard.
            </p>
            <div class="mt-6 flex justify-center gap-2 text-sm font-mono text-slate-500 bg-slate-950/50 py-2 px-4 rounded-lg inline-block border border-slate-800">
                Base URL: <span id="base-url" class="text-blue-400">...</span>
            </div>
        </div>

        <!-- Testing Console -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sidebar / Menu -->
            <div class="lg:col-span-3 space-y-4">
                <div class="glass-panel rounded-xl p-4">
                    <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Playground</h3>
                    <div class="space-y-1">
                        <button onclick="switchTab('chat')" class="tab-btn w-full text-left px-3 py-2 rounded-lg text-sm font-medium bg-blue-600/20 text-blue-400 border border-blue-500/30 transition-all" data-tab="chat">
                            üí¨ Gemini Chat
                        </button>
                        <button onclick="switchTab('image')" class="tab-btn w-full text-left px-3 py-2 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition-all" data-tab="image">
                            üñºÔ∏è Image Generation
                        </button>
                        <button onclick="switchTab('health')" class="tab-btn w-full text-left px-3 py-2 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition-all" data-tab="health">
                            üíì Health Check
                        </button>
                    </div>
                </div>

                <div class="glass-panel rounded-xl p-4">
                    <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Available Models</h3>
                    <div id="models-list" class="space-y-2 text-xs text-slate-400">
                        <div class="animate-pulse">Loading models...</div>
                    </div>
                </div>
            </div>

            <!-- Main Panel -->
            <div class="lg:col-span-9">
                
                <!-- Chat Tab -->
                <div id="chat-tab" class="tab-content space-y-6">
                    <div class="glass-panel rounded-xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold flex items-center gap-2">
                                üí¨ Gemini Chat Playground
                                <span class="px-2 py-0.5 rounded text-xs bg-blue-500/20 text-blue-400 border border-blue-500/30">v2</span>
                            </h2>
                            <select id="chat-model" class="bg-slate-800 border border-slate-700 rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="gemini-2.0-flash">gemini-2.0-flash (Fast)</option>
                                <option value="gemini-2.5-flash">gemini-2.5-flash (Thinking)</option>
                                <option value="gemini-2.5-pro">gemini-2.5-pro (Premium)</option>
                            </select>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-400 mb-2">System Instruction (Optional)</label>
                                <input type="text" id="chat-system" placeholder="You are a helpful assistant..." class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-400 mb-2">Prompt</label>
                                <textarea id="chat-prompt" rows="4" placeholder="Ask something..." class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all font-mono">Explain quantum computing in simple terms</textarea>
                            </div>

                            <div class="flex items-center gap-6">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="chat-stream" class="w-4 h-4 rounded border-slate-700 bg-slate-800 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm text-slate-300">Enable Streaming</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="chat-thinking" class="w-4 h-4 rounded border-slate-700 bg-slate-800 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm text-slate-300">Show Thoughts (Thinking Mode)</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="chat-search" class="w-4 h-4 rounded border-slate-700 bg-slate-800 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm text-slate-300">Google Search</span>
                                </label>
                            </div>

                            <button onclick="sendChat()" id="chat-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-medium py-2.5 rounded-lg transition-all flex items-center justify-center gap-2">
                                <span>Send Request</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                            </button>
                        </div>
                    </div>

                    <!-- Response Area -->
                    <div class="glass-panel rounded-xl p-6 relative">
                        <div class="absolute top-4 right-4 text-xs text-slate-500 font-mono" id="chat-latency"></div>
                        <h3 class="text-sm font-semibold text-slate-400 mb-3">Response</h3>
                        
                        <!-- Thoughts Section -->
                        <div id="chat-thoughts" class="hidden mb-4 p-4 bg-amber-900/10 border border-amber-500/20 rounded-lg">
                            <div class="text-xs font-bold text-amber-500 mb-2 uppercase tracking-wider flex items-center gap-2">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                                Thinking Process
                            </div>
                            <div id="chat-thoughts-content" class="text-sm text-amber-200/80 font-mono whitespace-pre-wrap"></div>
                        </div>

                        <div id="chat-response" class="min-h-[100px] text-sm text-slate-300 whitespace-pre-wrap font-mono bg-slate-950 rounded-lg p-4 border border-slate-800">
                            Waiting for request...
                        </div>
                        
                        <div id="chat-json" class="mt-4 hidden">
                            <div class="text-xs font-semibold text-slate-500 mb-2">Raw JSON</div>
                            <pre><code class="language-json rounded-lg text-xs" id="chat-json-content"></code></pre>
                        </div>
                    </div>
                </div>

                <!-- Image Tab -->
                <div id="image-tab" class="tab-content hidden space-y-6">
                    <div class="glass-panel rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                            üñºÔ∏è Image Generation
                            <span class="px-2 py-0.5 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">Vertex AI</span>
                        </h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-400 mb-2">Prompt</label>
                                <textarea id="image-prompt" rows="3" placeholder="A futuristic city in cyberpunk style..." class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-purple-500 outline-none transition-all">A cute robot painting a canvas, digital art, 4k</textarea>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Model</label>
                                    <select id="image-model" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none">
                                        <option value="imagen-3.0-generate-001">Imagen 3.0 (Fast)</option>
                                        <option value="imagen-3.0-fast-generate-001">Imagen 3.0 Fast</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Aspect Ratio</label>
                                    <select id="image-ratio" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none">
                                        <option value="1:1">1:1 (Square)</option>
                                        <option value="16:9">16:9 (Landscape)</option>
                                        <option value="9:16">9:16 (Portrait)</option>
                                    </select>
                                </div>
                            </div>

                            <button onclick="generateImage()" id="image-btn" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-medium py-2.5 rounded-lg transition-all">
                                Generate Image
                            </button>
                        </div>
                    </div>

                    <div class="glass-panel rounded-xl p-6">
                        <h3 class="text-sm font-semibold text-slate-400 mb-3">Result</h3>
                        <div id="image-result" class="min-h-[200px] flex items-center justify-center bg-slate-950 rounded-lg border border-slate-800 border-dashed">
                            <span class="text-slate-600 text-sm">Generated image will appear here</span>
                        </div>
                    </div>
                </div>

                <!-- Health Tab -->
                <div id="health-tab" class="tab-content hidden space-y-6">
                    <div class="glass-panel rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-6">System Health</h2>
                        <button onclick="checkHealth()" class="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-sm mb-4">Refresh Status</button>
                        <pre><code class="language-json rounded-lg" id="health-json">Click refresh to check status...</code></pre>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // Configuration
        const BASE_URL = window.location.origin;
        document.getElementById('base-url').textContent = BASE_URL;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkHealth();
            fetchModels();
            hljs.highlightAll();
        });

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('bg-blue-600/20', 'text-blue-400', 'border', 'border-blue-500/30');
                el.classList.add('text-slate-400', 'hover:bg-slate-800');
            });
            
            const activeBtn = document.querySelector(`button[data-tab="${tabName}"]`);
            activeBtn.classList.remove('text-slate-400', 'hover:bg-slate-800');
            activeBtn.classList.add('bg-blue-600/20', 'text-blue-400', 'border', 'border-blue-500/30');
        }

        // API Functions
        async function checkHealth() {
            try {
                const res = await fetch(`${BASE_URL}/api/v2/health`);
                const data = await res.json();
                
                document.getElementById('health-json').textContent = JSON.stringify(data, null, 2);
                hljs.highlightElement(document.getElementById('health-json'));

                const statusEl = document.getElementById('server-status');
                if (data.status === 'ok') {
                    statusEl.textContent = 'Online';
                    statusEl.classList.add('text-green-400');
                } else {
                    statusEl.textContent = 'Issues Detected';
                    statusEl.classList.add('text-red-400');
                }
            } catch (e) {
                document.getElementById('server-status').textContent = 'Offline';
            }
        }

        async function fetchModels() {
            try {
                const res = await fetch(`${BASE_URL}/api/v2/models`);
                const data = await res.json();
                const list = document.getElementById('models-list');
                list.innerHTML = '';
                
                data.models.forEach(model => {
                    const div = document.createElement('div');
                    div.className = 'p-2 rounded bg-slate-800/50 border border-slate-700/50';
                    div.innerHTML = `
                        <div class="font-medium text-slate-300">${model.displayName}</div>
                        <div class="text-[10px] text-slate-500 font-mono">${model.name}</div>
                        ${model.supportsThinking ? '<span class="inline-block mt-1 px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-500 text-[10px]">Thinking</span>' : ''}
                    `;
                    list.appendChild(div);
                });
            } catch (e) {
                document.getElementById('models-list').innerHTML = '<div class="text-red-400">Failed to load models</div>';
            }
        }

        async function sendChat() {
            const btn = document.getElementById('chat-btn');
            const responseEl = document.getElementById('chat-response');
            const jsonEl = document.getElementById('chat-json-content');
            const thoughtsContainer = document.getElementById('chat-thoughts');
            const thoughtsContent = document.getElementById('chat-thoughts-content');
            
            const prompt = document.getElementById('chat-prompt').value;
            const model = document.getElementById('chat-model').value;
            const system = document.getElementById('chat-system').value;
            const stream = document.getElementById('chat-stream').checked;
            const thinking = document.getElementById('chat-thinking').checked;
            const search = document.getElementById('chat-search').checked;

            // Reset UI
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-spin">‚åõ</span> Processing...';
            responseEl.textContent = '';
            thoughtsContent.textContent = '';
            thoughtsContainer.classList.add('hidden');
            document.getElementById('chat-json').classList.add('hidden');

            const payload = {
                prompt,
                model,
                stream,
                ...(system && { systemInstruction: system }),
                ...(thinking && { thinkingConfig: { includeThoughts: true, thinkingBudget: 4096 } }),
                ...(search && { tools: [{ googleSearch: {} }] })
            };

            const startTime = Date.now();

            try {
                if (stream) {
                    const response = await fetch(`${BASE_URL}/api/v2/chat/stream`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        
                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n');
                        
                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                const dataStr = line.replace('data: ', '');
                                if (dataStr === '[DONE]') break;
                                
                                try {
                                    const data = JSON.parse(dataStr);
                                    
                                    // Handle thoughts
                                    if (data.thought) {
                                        thoughtsContainer.classList.remove('hidden');
                                        thoughtsContent.textContent += data.thought;
                                    }
                                    
                                    // Handle text
                                    if (data.text) {
                                        responseEl.textContent += data.text;
                                    }
                                } catch (e) {}
                            }
                        }
                    }
                } else {
                    const response = await fetch(`${BASE_URL}/api/v2/chat/generate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    const data = await response.json();
                    
                    // Show thoughts if any
                    if (data.thoughts && data.thoughts.length > 0) {
                        thoughtsContainer.classList.remove('hidden');
                        thoughtsContent.textContent = data.thoughts.join('\n');
                    }

                    responseEl.textContent = data.text;
                    jsonEl.textContent = JSON.stringify(data, null, 2);
                    document.getElementById('chat-json').classList.remove('hidden');
                    hljs.highlightElement(jsonEl);
                }
            } catch (e) {
                responseEl.textContent = `Error: ${e.message}`;
                responseEl.classList.add('text-red-400');
            } finally {
                const latency = Date.now() - startTime;
                document.getElementById('chat-latency').textContent = `${latency}ms`;
                btn.disabled = false;
                btn.innerHTML = '<span>Send Request</span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>';
            }
        }

        async function generateImage() {
            const btn = document.getElementById('image-btn');
            const resultEl = document.getElementById('image-result');
            const prompt = document.getElementById('image-prompt').value;
            const model = document.getElementById('image-model').value;

            btn.disabled = true;
            btn.textContent = 'Generating... (This may take 10-20s)';
            resultEl.innerHTML = '<div class="animate-pulse text-purple-400">Creating masterpiece...</div>';

            try {
                const response = await fetch(`${BASE_URL}/api/v1/image/text-to-image`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt,
                        model,
                        sampleCount: 1
                    })
                });

                const data = await response.json();

                if (data.success && data.images && data.images.length > 0) {
                    const imgUrl = data.images[0].url;
                    resultEl.innerHTML = `<img src="${imgUrl}" class="max-w-full h-auto rounded-lg shadow-lg border border-slate-700" alt="Generated Image">`;
                } else {
                    throw new Error('No image generated');
                }
            } catch (e) {
                resultEl.innerHTML = `<div class="text-red-400 p-4 text-center">Failed: ${e.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Generate Image';
            }
        }
    </script>
</body>
</html>
